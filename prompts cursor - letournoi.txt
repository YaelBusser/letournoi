ğŸŒ Contexte du projet

Nous dÃ©veloppons une plateforme web de gestion de tournois (MVP).
Objectif : permettre Ã  des particuliers, associations ou entreprises de crÃ©er, organiser et participer Ã  des tournois (jeux vidÃ©o, sport, jeux de sociÃ©tÃ©).

Le projet est dÃ©veloppÃ© en mode agile (SCRUM).
Chaque fonctionnalitÃ© est dÃ©coupÃ©e en Ã©popÃ©es â†’ user stories â†’ tÃ¢ches techniques.
Les prompts fournis doivent Ãªtre utilisÃ©s dans Cursor pour gÃ©nÃ©rer du code et avancer sprint par sprint.

ğŸ› ï¸ Stack technique

Frontend : Next.js (React, TypeScript, SEO-ready)

Backend : Next.js API routes (Node.js + Express-like)

ORM : Prisma (MariaDB)

Auth : NextAuth.js (JWT + Google login)

DB : MariaDB

Paiements : Stripe (checkout + webhook)

Infra : VPS (Docker, docker-compose, CI/CD GitHub Actions)

Emails : Nodemailer (SMTP ou SendGrid)


ğŸŸ¦ Ã‰popÃ©e 1 : Gestion des comptes et rÃ´les
ğŸ¯ Objectif Sprint :

Inscription / connexion (email + Google), profil utilisateur minimal.

Prompt 1 : Configurer Prisma + MariaDB
Je veux configurer Prisma dans mon projet Next.js avec MariaDB.

1. Ajoute Prisma au projet et initialise le schÃ©ma.
2. CrÃ©e le modÃ¨le `User` avec les champs :
   - id (string, cuid, primary key)
   - email (unique)
   - passwordHash (nullable si connexion via Google)
   - pseudo (string)
   - type (enum : "particulier", "association", "entreprise")
   - avatarUrl (string, optionnel)
   - createdAt, updatedAt

3. Configure Prisma Client dans `lib/prisma.ts`.
4. GÃ©nÃ¨re une premiÃ¨re migration `init`.

Prompt 2 : Mettre en place NextAuth.js
Je veux intÃ©grer NextAuth.js avec Prisma Adapter.

1. Ajoute NextAuth.js au projet.
2. Configure lâ€™authentification par email/password custom.
3. Utilise PrismaAdapter pour stocker les sessions et utilisateurs.
4. Mets en place les API routes `/api/auth/[...nextauth].ts`.
5. Configure JWT pour les sessions.

Prompt 3 : Inscription manuelle
Je veux crÃ©er une page `/register` avec un formulaire dâ€™inscription.

1. Champs : email, mot de passe, pseudo.
2. Au submit â†’ hash du mot de passe avec bcrypt â†’ crÃ©ation utilisateur en DB via Prisma.
3. Redirection vers `/login` aprÃ¨s succÃ¨s.

Prompt 4 : Page Profil
Je veux crÃ©er une page `/profile`.

1. Accessible uniquement si lâ€™utilisateur est connectÃ©.
2. Affiche pseudo, email, photo de profil.
3. Formulaire pour mettre Ã  jour pseudo + photo.
4. Utilise NextAuth session pour rÃ©cupÃ©rer les infos utilisateur.

ğŸŸ¦ Ã‰popÃ©e 2 : Gestion des tournois
ğŸ¯ Objectif Sprint :

CrÃ©ation + rejoindre + Ã©quipes + validation rÃ©sultats.

Prompt 1 : ModÃ¨les Prisma
Je veux dÃ©finir les modÃ¨les Prisma pour les tournois :

- Tournament :
  - id (cuid), name, description, game, format, visibility (enum : public/private), price (float), startDate, endDate, createdBy (User relation)
- Team :
  - id, name, tournamentId, captainId (User relation)
- TeamMember :
  - id, teamId, userId
- Match :
  - id, tournamentId, round, teamAId, teamBId, winnerId (nullable)

Prompt 2 : API crÃ©ation de tournoi
CrÃ©e une API `/api/tournaments` avec Next.js API routes :

- POST â†’ crÃ©er un tournoi.
- GET â†’ liste des tournois.
- GET /:id â†’ dÃ©tails tournoi.
- PATCH â†’ mise Ã  jour tournoi (organisateur seulement).

Prompt 3 : UI crÃ©ation tournoi
CrÃ©e une page `/tournaments/create`.

1. Formulaire : nom, description, jeu (select), format (elim directe par dÃ©faut), visibilitÃ© (radio public/privÃ©), date dÃ©but/fin.
2. Soumission â†’ appel API POST `/api/tournaments`.
3. Redirection vers `/tournaments/[id]`.

Prompt 4 : Gestion Ã©quipes
CrÃ©e une API `/api/teams` :
- POST : crÃ©er une Ã©quipe (nom + joueurs).
- POST /:id/join : rejoindre une Ã©quipe.
- GET /:tournamentId : liste Ã©quipes.

CrÃ©e une UI sur la page tournoi :
- Liste des Ã©quipes inscrites.
- Bouton "CrÃ©er une Ã©quipe".
- Bouton "Rejoindre une Ã©quipe".

Prompt 5 : Validation rÃ©sultats
CrÃ©e une API `/api/results` :
- POST : organiser valide un rÃ©sultat â†’ enregistre vainqueur du match.
- GET /:matchId : rÃ©cupÃ©rer Ã©tat dâ€™un match.

UI dans la page tournoi :
- Liste matchs avec Ã©tat.
- Si organisateur â†’ bouton "Valider rÃ©sultat".

ğŸŸ¦ Ã‰popÃ©e 3 : MonÃ©tisation & paiements
ğŸ¯ Objectif Sprint :

Tournois gratuits + payants.

Prompt 1 : IntÃ©gration Stripe
IntÃ¨gre Stripe dans mon projet Next.js.

1. Ajoute SDK Stripe.
2. Ajoute champ `price` dans Tournament.
3. CrÃ©e une API `/api/payment/checkout` qui gÃ©nÃ¨re une session de paiement.
4. Webhook Stripe `/api/payment/webhook` â†’ enregistre paiement et ajoute lâ€™utilisateur au tournoi.

Prompt 2 : UI paiement
Dans la page tournoi, si `price > 0` :
- Afficher bouton "Payer et rejoindre".
- Au clic â†’ appel API checkout â†’ redirection Stripe.
- AprÃ¨s succÃ¨s â†’ redirection vers `/tournaments/[id]`.

ğŸŸ¦ Ã‰popÃ©e 4 : Engagement & expÃ©rience utilisateur
ğŸ¯ Objectif Sprint :

Leaderboard + profils publics + email notifications.

Prompt 1 : Leaderboard
CrÃ©e un leaderboard par tournoi.

1. Endpoint `/api/tournaments/:id/leaderboard` â†’ retourne classement basÃ© sur victoires.
2. UI sur la page tournoi : tableau classement.

Prompt 2 : Profil public
CrÃ©e une page `/users/[id]`.

1. Affiche pseudo, avatar, liste des tournois rejoints et crÃ©Ã©s.
2. Accessible mÃªme sans Ãªtre connectÃ©.

Prompt 3 : Notifications email
Ajoute un systÃ¨me dâ€™email.

1. Utilise Nodemailer (SMTP local ou SendGrid).
2. Envoie un email quand :
   - un joueur rejoint un tournoi
   - un tournoi commence
   - un joueur gagne un match
3. CrÃ©e une utilitaire `lib/email.ts` pour factoriser lâ€™envoi.

ğŸŸ¦ Ã‰popÃ©e 5 : Infra & DevOps
ğŸ¯ Objectif Sprint :

Docker + migrations + CI/CD.

Prompt 1 : Docker
CrÃ©e un Dockerfile pour Next.js avec Prisma et MariaDB.

1. Multi-stage build.
2. DÃ©marre en prod sur `npm run start`.
3. docker-compose.yml avec :
   - app (Next.js)
   - db (MariaDB)

Prompt 2 : Prisma migrations
Ajoute un script dans package.json :
- "migrate:dev" â†’ `prisma migrate dev`
- "migrate:deploy" â†’ `prisma migrate deploy`

Assure-toi que Ã§a tourne au build Docker.

Prompt 3 : CI/CD
Mets en place GitHub Actions pour CI/CD.

1. Lint + test.
2. Build image Docker.
3. DÃ©ploiement auto sur VPS via SSH ou Docker registry.